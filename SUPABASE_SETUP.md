# Supabase Setup Guide

To enable dynamic project management, follow these steps to set up your Supabase database:

1.  **Create a Project**: Go to [Supabase](https://supabase.com/) and create a new project.
2.  **Get Credentials**:
    *   Go to **Project Settings** -> **API**.
    *   Copy the `URL` and `anon public` key.
    *   Add them to your `.env.local` file (create it if it doesn't exist):

    ```env
    NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
    NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
    ```

3.  **Run SQL Query**: Go to the **SQL Editor** in your Supabase dashboard and run the following script to create the necessary tables and enable Row Level Security (RLS) policies.

```sql
-- 1. Create the projects table
create table if not exists projects (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  description text not null,
  long_description text,
  image text not null,
  images text[] default '{}',
  tags text[] not null,
  category text not null,
  github_link text,
  live_link text,
  featured boolean default false
);

-- 2. Create the experience table
create table if not exists experience (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  year text not null,
  title text not null,
  company text not null,
  type text not null check (type in ('work', 'education', 'achievement')),
  description text not null,
  skills text[] default '{}'
);

-- 3. Create the socials table
create table if not exists socials (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  platform text not null,
  url text not null,
  icon_name text not null
);

-- 4. Create the site_content table
create table if not exists site_content (
  id bigint generated by default as identity primary key,
  section_key text not null unique,
  content jsonb not null default '{}'::jsonb,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Enable Row Level Security (RLS) on all tables
alter table projects enable row level security;
alter table experience enable row level security;
alter table socials enable row level security;
alter table site_content enable row level security;

-- Create Policies for Public Read Access
create policy "Public projects are viewable by everyone" on projects for select using (true);
create policy "Public experiences are viewable by everyone" on experience for select using (true);
create policy "Public socials are viewable by everyone" on socials for select using (true);
create policy "Public content is viewable by everyone" on site_content for select using (true);

-- Create Policies for Authenticated Admin Access (All operations)
create policy "Admins can manage projects" on projects for all using (auth.role() = 'authenticated');
create policy "Admins can manage experience" on experience for all using (auth.role() = 'authenticated');
create policy "Admins can manage socials" on socials for all using (auth.role() = 'authenticated');
create policy "Admins can manage content" on site_content for all using (auth.role() = 'authenticated');

-- 5. Create buckets for storage
INSERT INTO storage.buckets (id, name, public) 
VALUES ('project-images', 'project-images', true)
ON CONFLICT (id) DO NOTHING;

INSERT INTO storage.buckets (id, name, public) 
VALUES ('personal-assets', 'personal-assets', true)
ON CONFLICT (id) DO NOTHING;

-- Storage Policies
CREATE POLICY "Public access to project images" ON storage.objects FOR SELECT USING (bucket_id = 'project-images');
CREATE POLICY "Admins can upload project images" ON storage.objects FOR INSERT WITH CHECK (bucket_id = 'project-images' AND auth.role() = 'authenticated');

CREATE POLICY "Public access to personal assets" ON storage.objects FOR SELECT USING (bucket_id = 'personal-assets');
CREATE POLICY "Admins can upload personal assets" ON storage.objects FOR INSERT WITH CHECK (bucket_id = 'personal-assets' AND auth.role() = 'authenticated');
```

4.  **Create a User**: Go to **Authentication** -> **Users** and add a user (this will be your admin account).
5.  **Restart Dev Server**: After adding `.env` variables, restart `npm run dev`.
